webpackJsonp([11],{1425:function(n,l,e){"use strict";function t(n){return d._27(0,[(n()(),d._3(0,0,null,null,7,"ion-chip",[["class","addon-messages-date"],["color","light"]],null,null,null,null,null)),d._2(1,16384,null,0,O.a,[N.a,d.l,d.C],{color:[0,"color"]},null),(n()(),d._25(-1,null,["\n                    "])),(n()(),d._3(3,0,null,null,3,"ion-label",[],null,null,null,null,null)),d._2(4,16384,null,0,H.a,[N.a,d.l,d.C,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),d._25(5,null,["",""])),d._20(6,2),(n()(),d._25(-1,null,["\n                "]))],function(n,l){n(l,1,0,"light")},function(n,l){n(l,5,0,d._26(l,5,0,n(l,6,0,d._15(l.parent.parent,0),l.parent.context.$implicit.timecreated,"LL")))})}function s(n){return d._27(0,[(n()(),d._3(0,0,null,null,11,"ion-chip",[["class","addon-messages-unreadfrom"],["color","light"]],null,null,null,null,null)),d._2(1,16384,null,0,O.a,[N.a,d.l,d.C],{color:[0,"color"]},null),(n()(),d._25(-1,null,["\n                    "])),(n()(),d._3(3,0,null,null,4,"ion-label",[],null,null,null,null,null)),d._2(4,16384,null,0,H.a,[N.a,d.l,d.C,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),d._25(5,null,["",""])),d._19(6,{$a:0}),d._18(131072,j.a,[J.a,d.g]),(n()(),d._25(-1,null,["\n                    "])),(n()(),d._3(9,0,null,null,1,"ion-icon",[["name","arrow-round-down"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._2(10,147456,null,0,K.a,[N.a,d.l,d.C],{name:[0,"name"]},null),(n()(),d._25(-1,null,["\n                "]))],function(n,l){n(l,1,0,"light");n(l,10,0,"arrow-round-down")},function(n,l){var e=l.component;n(l,5,0,d._26(l,5,0,d._15(l,7).transform("addon.messages.newmessages",n(l,6,0,e.title))));n(l,9,0,d._15(l,10)._hidden)})}function a(n){return d._27(0,[(n()(),d._3(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),d._2(1,16384,null,0,V.a,[N.a,d.l,d.C],null,null),(n()(),d._25(2,null,["\n                        ","\n                    "])),d._20(3,2)],null,function(n,l){n(l,2,0,d._26(l,2,0,n(l,3,0,d._15(l.parent.parent,0),l.parent.context.$implicit.timecreated,"dftimedate")))})}function o(n){return d._27(0,[(n()(),d._3(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),d._2(1,16384,null,0,V.a,[N.a,d.l,d.C],null,null),(n()(),d._3(2,0,null,null,1,"ion-icon",[["name","time"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._2(3,147456,null,0,K.a,[N.a,d.l,d.C],{name:[0,"name"]},null)],function(n,l){n(l,3,0,"time")},function(n,l){n(l,2,0,d._15(l,3)._hidden)})}function i(n){return d._27(0,[(n()(),d._3(0,0,null,null,6,"button",[["class","addon-messages-delete-button"],["clear","true"],["icon-only",""],["ion-button",""]],[[24,"@coreSlideInOut",0],[1,"aria-label",0]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.deleteMessage(n.parent.context.$implicit,n.parent.context.index)&&t}return t},Y.b,Y.a)),d._2(1,1097728,[[5,4]],0,W.a,[[8,""],N.a,d.l,d.C],{clear:[0,"clear"]},null),d._18(131072,j.a,[J.a,d.g]),(n()(),d._25(-1,0,["\n                        "])),(n()(),d._3(4,0,null,0,1,"ion-icon",[["color","danger"],["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._2(5,147456,null,0,K.a,[N.a,d.l,d.C],{color:[0,"color"],name:[1,"name"]},null),(n()(),d._25(-1,0,["\n                    "]))],function(n,l){n(l,1,0,"true");n(l,5,0,"danger","trash")},function(n,l){n(l,0,0,"fromRight",d._26(l,0,1,d._15(l,2).transform("addon.messages.deletemessage")));n(l,4,0,d._15(l,5)._hidden)})}function u(n){return d._27(0,[(n()(),d._3(0,0,null,null,32,null,null,null,null,null,null,null)),(n()(),d._25(-1,null,["\n                "])),(n()(),d.Y(16777216,null,null,1,null,t)),d._2(3,16384,null,0,q.k,[d.M,d.J],{ngIf:[0,"ngIf"]},null),(n()(),d._25(-1,null,["\n\n                "])),(n()(),d.Y(16777216,null,null,1,null,s)),d._2(6,16384,null,0,q.k,[d.M,d.J],{ngIf:[0,"ngIf"]},null),(n()(),d._25(-1,null,["\n\n                "])),(n()(),d._3(8,0,null,null,23,"ion-item",[["class","addon-message item item-block"],["text-wrap",""]],[[2,"addon-message-mine",null],[24,"@coreSlideInOut",0]],[[null,"longPress"]],function(n,l,e){var t=!0;if("longPress"===l){t=!1!==n.component.copyMessage(n.context.$implicit.smallmessage)&&t}return t},G.b,G.a)),d._2(9,212992,null,0,Z.a,[d.l],null,{longPress:"longPress"}),d._2(10,1097728,null,3,Q.a,[nn.a,N.a,d.l,d.C,[2,ln.a]],null,null),d._23(335544320,4,{contentLabel:0}),d._23(603979776,5,{_buttons:1}),d._23(603979776,6,{_icons:1}),d._2(14,16384,null,0,en.a,[],null,null),(n()(),d._25(-1,2,["\n                    "])),(n()(),d._25(-1,2,["\n                    "])),(n()(),d._3(17,0,null,2,4,"p",[["class","addon-message-text"]],null,null,null,null,null)),(n()(),d._25(-1,null,["\n                        "])),(n()(),d._3(19,0,null,null,1,"core-format-text",[],null,[[null,"afterRender"]],function(n,l,e){var t=!0;if("afterRender"===l){t=!1!==(n.context.last&&n.component.scrollToBottom())&&t}return t},null,null)),d._2(20,540672,null,0,tn.a,[d.l,m.a,y.a,sn.a,J.a,an.a,v.a,on.a,b.a,un.a,M.a,rn.a,[2,cn.a],[2,dn.a]],{text:[0,"text"]},{afterRender:"afterRender"}),(n()(),d._25(-1,null,["\n                    "])),(n()(),d._25(-1,2,["\n                    "])),(n()(),d.Y(16777216,null,2,1,null,a)),d._2(24,16384,null,0,q.k,[d.M,d.J],{ngIf:[0,"ngIf"]},null),(n()(),d._25(-1,2,["\n                    "])),(n()(),d.Y(16777216,null,2,1,null,o)),d._2(27,16384,null,0,q.k,[d.M,d.J],{ngIf:[0,"ngIf"]},null),(n()(),d._25(-1,2,["\n\n                    "])),(n()(),d.Y(16777216,null,2,1,null,i)),d._2(30,16384,null,0,q.k,[d.M,d.J],{ngIf:[0,"ngIf"]},null),(n()(),d._25(-1,2,["\n                "])),(n()(),d._25(-1,null,["\n            "]))],function(n,l){var e=l.component;n(l,3,0,e.showDate(l.context.$implicit,e.messages[l.context.index-1]));n(l,6,0,l.context.$implicit.unreadFrom),n(l,9,0);n(l,20,0,l.context.$implicit.text);n(l,24,0,!l.context.$implicit.pending);n(l,27,0,l.context.$implicit.pending);n(l,30,0,!l.context.$implicit.sending&&e.showDelete)},function(n,l){var e=l.component;n(l,8,0,l.context.$implicit.useridfrom==e.currentUserId,l.context.$implicit.useridfrom==e.currentUserId?"":"fromLeft")})}function r(n){return d._27(0,[(n()(),d._3(0,0,null,null,2,"core-empty-box",[["icon","chatbubbles"]],null,null,null,gn.b,gn.a)),d._2(1,49152,null,0,fn.a,[],{message:[0,"message"],icon:[1,"icon"]},null),d._18(131072,j.a,[J.a,d.g])],function(n,l){n(l,1,0,d._26(l,1,0,d._15(l,2).transform("addon.messages.nomessages")),"chatbubbles")},null)}function c(n){return d._27(0,[d._18(0,mn.a,[b.a,J.a]),d._23(402653184,1,{content:0}),(n()(),d._3(2,0,null,null,35,"ion-header",[],null,null,null,null,null)),d._2(3,16384,null,0,hn.a,[N.a,d.l,d.C,[2,_n.a]],null,null),(n()(),d._25(-1,null,["\n    "])),(n()(),d._3(5,0,null,null,11,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,pn.b,pn.a)),d._2(6,49152,null,0,yn.a,[vn.a,[2,_n.a],[2,cn.a],N.a,d.l,d.C],null,null),(n()(),d._25(-1,3,["\n        "])),(n()(),d._3(8,0,null,3,3,"ion-title",[],null,null,null,bn.b,bn.a)),d._2(9,49152,null,0,Mn.a,[N.a,d.l,d.C,[2,Cn.a],[2,yn.a]],null,null),(n()(),d._3(10,0,null,0,1,"core-format-text",[],null,null,null,null,null)),d._2(11,540672,null,0,tn.a,[d.l,m.a,y.a,sn.a,J.a,an.a,v.a,on.a,b.a,un.a,M.a,rn.a,[2,cn.a],[2,dn.a]],{text:[0,"text"]},null),(n()(),d._25(-1,3,["\n        "])),(n()(),d._3(13,0,null,2,2,"ion-buttons",[["end",""]],null,null,null,null,null)),d._2(14,16384,null,1,In.a,[N.a,d.l,d.C,[2,Cn.a],[2,yn.a]],null,null),d._23(603979776,2,{_buttons:1}),(n()(),d._25(-1,3,["\n    "])),(n()(),d._25(-1,null,["\n    "])),(n()(),d._3(18,0,null,null,18,"core-navbar-buttons",[["end",""]],null,null,null,wn.b,wn.a)),d._2(19,245760,null,1,Pn.a,[d.l,b.a,y.a],null,null),d._23(603979776,3,{buttons:1}),(n()(),d._25(-1,0,["\n        "])),(n()(),d._3(22,0,null,0,5,"button",[["clear","true"],["icon-only",""],["ion-button",""]],[[8,"hidden",0]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.toggleDelete()&&t}return t},Y.b,Y.a)),d._2(23,1097728,[[3,4]],0,W.a,[[8,""],N.a,d.l,d.C],{clear:[0,"clear"]},null),(n()(),d._25(-1,0,["\n            "])),(n()(),d._3(25,0,null,0,1,"ion-icon",[["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._2(26,147456,null,0,K.a,[N.a,d.l,d.C],{name:[0,"name"]},null),(n()(),d._25(-1,0,["\n        "])),(n()(),d._25(-1,0,["\n        "])),(n()(),d._3(29,0,null,0,6,"a",[["core-user-link",""]],[[8,"hidden",0],[1,"aria-label",0]],null,null,null,null)),d._2(30,81920,null,0,Dn.a,[d.l,[2,cn.a]],{userId:[0,"userId"]},null),d._18(131072,j.a,[J.a,d.g]),(n()(),d._25(-1,null,["\n            "])),(n()(),d._3(33,0,null,null,1,"img",[["class","button core-bar-button-image"],["core-external-content",""],["onError","this.src='assets/img/user-avatar.png'"]],[[8,"src",4]],null,null,null,null)),d._2(34,4210688,null,0,xn.a,[d.l,b.a,un.a,an.a,m.a,y.a,on.a,M.a],null,null),(n()(),d._25(-1,null,["\n        "])),(n()(),d._25(-1,0,["\n    "])),(n()(),d._25(-1,null,["\n"])),(n()(),d._25(-1,null,["\n"])),(n()(),d._3(39,0,null,null,24,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,kn.b,kn.a)),d._2(40,4374528,[[1,4]],0,dn.a,[N.a,an.a,Ln.a,d.l,d.C,vn.a,Sn.a,d.x,[2,_n.a],[2,cn.a]],null,null),(n()(),d._25(-1,1,["\n    "])),(n()(),d._3(42,0,null,1,20,"core-loading",[],null,null,null,Un.b,Un.a)),d._2(43,638976,null,0,Fn.a,[J.a,d.l],{hideUntil:[0,"hideUntil"]},null),(n()(),d._25(-1,0,["\n        "])),(n()(),d._25(-1,0,["\n        "])),(n()(),d._3(46,0,null,0,5,"ion-infinite-scroll",[["position","top"]],null,[[null,"ionInfinite"]],function(n,l,e){var t=!0;if("ionInfinite"===l){t=!1!==n.component.loadPrevious(e)&&t}return t},null,null)),d._2(47,1196032,null,0,En.a,[dn.a,d.x,d.l,Ln.a],{enabled:[0,"enabled"],position:[1,"position"]},{ionInfinite:"ionInfinite"}),(n()(),d._25(-1,null,["\n           "])),(n()(),d._3(49,0,null,null,1,"ion-infinite-scroll-content",[],[[1,"state",0]],null,null,Rn.b,Rn.a)),d._2(50,114688,null,0,Tn.a,[En.a,N.a],null,null),(n()(),d._25(-1,null,["\n        "])),(n()(),d._25(-1,0,["\n        "])),(n()(),d._3(53,0,null,0,5,"ion-list",[["class","addon-messages-discussion-container"]],[[1,"aria-live",0]],null,null,null,null)),d._2(54,16384,null,0,Xn.a,[N.a,d.l,d.C,an.a,An.l,Ln.a],null,null),(n()(),d._25(-1,null,["\n            "])),(n()(),d.Y(16777216,null,null,1,null,u)),d._2(57,802816,null,0,q.j,[d.M,d.J,d.r],{ngForOf:[0,"ngForOf"]},null),(n()(),d._25(-1,null,["\n        "])),(n()(),d._25(-1,0,["\n        "])),(n()(),d.Y(16777216,null,0,1,null,r)),d._2(61,16384,null,0,q.k,[d.M,d.J],{ngIf:[0,"ngIf"]},null),(n()(),d._25(-1,0,["\n    "])),(n()(),d._25(-1,1,["\n"])),(n()(),d._25(-1,null,["\n"])),(n()(),d._3(65,0,null,null,10,"ion-footer",[["class","footer-adjustable"],["color","light"]],null,null,null,null,null)),d._2(66,16384,null,0,Bn.a,[N.a,d.l,d.C,[2,_n.a]],{color:[0,"color"]},null),(n()(),d._25(-1,null,["\n    "])),(n()(),d._3(68,0,null,null,6,"ion-toolbar",[["class","toolbar"],["color","light"],["position","bottom"]],[[2,"statusbar-padding",null]],null,null,zn.b,zn.a)),d._2(69,49152,null,0,Cn.a,[N.a,d.l,d.C],{color:[0,"color"]},null),(n()(),d._25(-1,3,["\n        "])),(n()(),d._3(71,0,null,3,2,"core-send-message-form",[],null,[[null,"onSubmit"],[null,"onResize"]],function(n,l,e){var t=!0,s=n.component;if("onSubmit"===l){t=!1!==s.sendMessage(e)&&t}if("onResize"===l){t=!1!==s.resizeContent()&&t}return t},$n.b,$n.a)),d._2(72,114688,null,0,On.a,[v.a,sn.a],{placeholder:[0,"placeholder"],showKeyboard:[1,"showKeyboard"]},{onSubmit:"onSubmit",onResize:"onResize"}),d._18(131072,j.a,[J.a,d.g]),(n()(),d._25(-1,3,["\n    "])),(n()(),d._25(-1,null,["\n"])),(n()(),d._25(-1,null,["\n"]))],function(n,l){var e=l.component;n(l,11,0,e.title),n(l,19,0);n(l,23,0,"true");n(l,26,0,"trash");n(l,30,0,e.userId);n(l,43,0,e.loaded);n(l,47,0,e.canLoadMore,"top"),n(l,50,0);n(l,57,0,e.messages);n(l,61,0,!e.messages||e.messages.length<=0);n(l,66,0,"light");n(l,69,0,"light");n(l,72,0,d._26(l,72,0,d._15(l,73).transform("addon.messages.newmessage")),e.showKeyboard)},function(n,l){var e=l.component;n(l,5,0,d._15(l,6)._hidden,d._15(l,6)._sbPadding);n(l,22,0,!e.canDelete);n(l,25,0,d._15(l,26)._hidden);n(l,29,0,!e.showProfileLink,d._26(l,29,1,d._15(l,31).transform("core.user.viewprofile")));n(l,33,0,e.profileLink);n(l,39,0,d._15(l,40).statusbarPadding,d._15(l,40)._hasRefresher);n(l,49,0,d._15(l,50).inf.state);n(l,53,0,e.polite);n(l,68,0,d._15(l,69)._sbPadding)})}Object.defineProperty(l,"__esModule",{value:!0});var d=e(1),g=(e(0),e(10),e(8)),f=e(22),m=e(2),h=e(151),_=e(410),p=e(45),y=e(7),v=e(5),b=e(3),M=e(13),C=(e(1005),e(175)),I=e(12),w=function(){function n(n,l,e,t,s,a,o,i,u,r,c,d){var g=this;this.eventsProvider=n,this.userProvider=t,this.navCtrl=s,this.messagesSync=a,this.domUtils=o,this.messagesProvider=i,this.utils=r,this.appProvider=c,this.translate=d,this.unreadMessageFrom=0,this.messagesBeingSent=0,this.pagesLoaded=1,this.lastMessage={text:"",timecreated:0},this.keepMessageMap={},this.oldContentHeight=0,this.loaded=!1,this.showKeyboard=!1,this.canLoadMore=!1,this.messages=[],this.showDelete=!1,this.canDelete=!1,this.scrollBottom=!0,this.viewDestroyed=!1,this.siteId=l.getCurrentSiteId(),this.currentUserId=l.getCurrentSiteUserId(),this.logger=u.getInstance("AddonMessagesDiscussionPage"),this.userId=e.get("userId"),this.showKeyboard=e.get("showKeyboard"),this.syncObserver=n.on(_.a.AUTO_SYNCED,function(n){n.userId==g.userId&&(g.fetchData(),n.warnings&&n.warnings[0]&&g.domUtils.showErrorModal(n.warnings[0]))},this.siteId)}return n.prototype.addMessage=function(n,l){void 0===l&&(l=!0),n.hash=C.Md5.hashAsciiStr(n.smallmessage)+"#"+n.timecreated+"#"+n.useridfrom,void 0===this.keepMessageMap[n.hash]&&this.messages.push(n),this.keepMessageMap[n.hash]=l},n.prototype.removeMessage=function(n){if(this.keepMessageMap[n])this.keepMessageMap[n]=!1;else{delete this.keepMessageMap[n];var l=this.messages.findIndex(function(l){return l.hash==n});l>0&&this.messages.splice(l,1)}},n.prototype.ionViewDidLoad=function(){var n=this,l=this.navCtrl.getPrevious()&&this.navCtrl.getPrevious().component.name;this.showProfileLink=!l||"CoreUserProfilePage"!==l,this.userProvider.getProfile(this.userId,void 0,!0).then(function(l){n.title||(n.title=l.fullname),n.profileLink=l.profileimageurl}),this.messagesSync.syncDiscussion(this.userId).catch(function(){}).then(function(l){return l&&l[0]&&n.domUtils.showErrorModal(l[0]),n.fetchData().then(function(){!n.title&&n.messages.length&&(n.title=n.messages[0].useridto!=n.currentUserId?n.messages[0].usertofullname||"":n.messages[0].userfromfullname||"")}).catch(function(l){n.domUtils.showErrorModalDefault(l,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){n.checkCanDelete(),n.resizeContent(),n.loaded=!0})})},n.prototype.ionViewDidEnter=function(){this.setPolling()},n.prototype.ionViewWillLeave=function(){this.unsetPolling()},n.prototype.fetchData=function(){var n=this;return this.logger.debug("Polling new messages for discussion with user '"+this.userId+"'"),this.messagesBeingSent>0?Promise.reject(null):this.fetching?Promise.reject(null):(this.fetching=!0,this.messagesSync.waitForSync(this.userId).then(function(){return n.messagesProvider.invalidateDiscussionCache(n.userId).catch(function(){})}).then(function(){return n.getDiscussion(n.pagesLoaded)}).then(function(l){if(n.viewDestroyed)return Promise.resolve();if(n.scrollBottom=n.content.scrollHeight-n.content.scrollTop===n.content.contentHeight,n.messagesBeingSent>0)return Promise.reject(null);l.forEach(function(l){n.addMessage(l)});for(var e in n.keepMessageMap)n.removeMessage(e);n.messagesProvider.sortMessages(n.messages),n.notifyNewMessage(),n.markMessagesAsRead()}).finally(function(){n.fetching=!1}))},n.prototype.getDiscussion=function(n,l,e,t,s){var a=this;void 0===l&&(l=0),void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s=0);return this.messagesProvider.getDiscussion(this.userId,l>0||e>0||t>0||s>0,l,e,t,s).then(function(o){return--n>0&&o.canLoadMore?(o.messages.forEach(function(n){n.pending||(n.useridfrom==a.userId?n.read?e++:l++:n.read?s++:t++)}),a.getDiscussion(n,l,e,t,s).then(function(n){return o.messages.concat(n)})):(a.canLoadMore=o.canLoadMore,o.messages)})},n.prototype.markMessagesAsRead=function(){var n=this,l=!1,e=[];if(this.messagesProvider.isMarkAllMessagesReadEnabled()){var t=!1;for(var s in this.messages){var a=this.messages[s];if(a.useridfrom!=this.currentUserId&&0==a.read){t=!0;break}}t&&(this.setUnreadLabelPosition(),e.push(this.messagesProvider.markAllMessagesRead(this.userId).then(function(){l=!0,n.messages.forEach(function(n){n.read=1})})))}else this.setUnreadLabelPosition(),this.messages.forEach(function(t){t.useridfrom!=n.currentUserId&&0==t.read&&e.push(n.messagesProvider.markMessageRead(t.id).then(function(){l=!0,t.read=1}))});Promise.all(e).finally(function(){l&&n.eventsProvider.trigger(h.a.READ_CHANGED_EVENT,{userId:n.userId},n.siteId)})},n.prototype.notifyNewMessage=function(){var n=this.messages[this.messages.length-1],l=!1;if(n?n.text===this.lastMessage.text&&n.timecreated===this.lastMessage.timecreated||(this.lastMessage={text:n.text,timecreated:n.timecreated},l=!0):(this.lastMessage={text:"",timecreated:0},l=!0),l){this.eventsProvider.trigger(h.a.NEW_MESSAGE_EVENT,{userId:this.userId,message:this.lastMessage.text,timecreated:this.lastMessage.timecreated},this.siteId);this.canDelete!=(n&&n.id&&1==this.messages.length||this.messages.length>1)&&this.checkCanDelete()}},n.prototype.setUnreadLabelPosition=function(){if(0==this.unreadMessageFrom){var n=!1;for(var l in this.messages){var e=this.messages[l];if(e.useridfrom!=this.currentUserId){if(e.unreadFrom=0==e.read&&n,e.unreadFrom){this.unreadMessageFrom=parseInt(e.id,10);break}n=0!=e.read}}0==this.unreadMessageFrom&&(this.unreadMessageFrom=-1)}},n.prototype.checkCanDelete=function(){var n=this.messages[0];this.canDelete=n&&!n.sending},n.prototype.hideUnreadLabel=function(){if(this.unreadMessageFrom>0){for(var n in this.messages){var l=this.messages[n];if(l.id==this.unreadMessageFrom){l.unreadFrom=!1;break}}this.unreadMessageFrom=-1}},n.prototype.waitForFetch=function(){var n=this;if(!this.fetching)return Promise.resolve();var l=this.utils.promiseDefer();return setTimeout(function(){return n.waitForFetch().finally(function(){l.resolve()})},400),l.promise},n.prototype.setPolling=function(){var n=this;this.polling||(this.polling=setInterval(function(){n.fetchData().catch(function(){})},h.a.POLL_INTERVAL))},n.prototype.unsetPolling=function(){this.polling&&(this.logger.debug("Cancelling polling for conversation with user '"+this.userId+"'"),clearInterval(this.polling),this.polling=void 0)},n.prototype.copyMessage=function(n){this.utils.copyToClipboard(n)},n.prototype.deleteMessage=function(n,l){var e=this;this.domUtils.showConfirm(this.translate.instant(n.pending?"core.areyousure":"addon.messages.deletemessageconfirmation")).then(function(){var t=e.domUtils.showModalLoading("core.deleting",!0);return e.messagesProvider.deleteMessage(n).then(function(){e.messages.splice(l,1),e.removeMessage(n.hash),e.notifyNewMessage(),e.fetchData()}).finally(function(){t.dismiss()})}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.messages.errordeletemessage",!0)})},n.prototype.loadPrevious=function(n){var l=this;return this.waitForFetch().finally(function(){l.pagesLoaded++,l.fetchData().catch(function(n){l.pagesLoaded--,l.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){n.complete()})})},n.prototype.resizeContent=function(){var n=this,l=this.content.getContentDimensions().scrollTop;this.content.resize(),setTimeout(function(){!n.viewDestroyed&&n.content&&n.content.contentHeight!=n.oldContentHeight&&(l||(l=n.content.getContentDimensions().scrollTop),l+=n.oldContentHeight-n.content.contentHeight,n.oldContentHeight=n.content.contentHeight,n.content.scrollTo(0,l,0))})},n.prototype.scrollToBottom=function(){var n=this;this.scrollBottom&&(setTimeout(function(){n.viewDestroyed||n.content.scrollToBottom(0)}),this.scrollBottom=!1)},n.prototype.sendMessage=function(n){var l,e=this;this.hideUnreadLabel(),this.showDelete=!1,this.scrollBottom=!0,l={pending:!0,sending:!0,useridfrom:this.currentUserId,smallmessage:n,text:n,timecreated:(new Date).getTime()},this.addMessage(l,!1),this.messagesBeingSent++,this.waitForFetch().finally(function(){e.messagesProvider.sendMessage(e.userId,n).then(function(n){e.messagesBeingSent--,(n.sent?e.fetchData():Promise.reject(null)).catch(function(){l.sending=!1,n.sent?l.pending=!1:n.message&&(l.timecreated=n.message.timecreated),e.notifyNewMessage()})}).catch(function(n){e.messagesBeingSent--,e.appProvider.closeKeyboard(),e.domUtils.showErrorModalDefault(n,"addon.messages.messagenotsent",!0),e.removeMessage(l.hash)})})},n.prototype.showDate=function(n,l){return!l||!n.pending&&!I(n.timecreated).isSame(l.timecreated,"day")},n.prototype.toggleDelete=function(){this.showDelete=!this.showDelete},n.prototype.ngOnDestroy=function(){this.unsetPolling(),this.syncObserver&&this.syncObserver.off(),this.viewDestroyed=!0},n}(),P=e(33),D=e(31),x=e(119),k=function(){return function(){}}(),L=e(925),S=e(926),U=e(927),F=e(928),E=e(929),R=e(930),T=e(931),X=e(932),A=e(933),B=e(936),z=e(937),$=e(938),O=e(567),N=e(4),H=e(62),j=e(29),J=e(17),K=e(38),V=e(227),Y=e(44),W=e(39),q=e(9),G=e(34),Z=e(1002),Q=e(20),nn=e(19),ln=e(30),en=e(32),tn=e(41),sn=e(11),an=e(14),on=e(24),un=e(16),rn=e(23),cn=e(21),dn=e(25),gn=e(149),fn=e(130),mn=e(309),hn=e(391),_n=e(35),pn=e(934),yn=e(179),vn=e(28),bn=e(935),Mn=e(308),Cn=e(223),In=e(392),wn=e(81),Pn=e(72),Dn=e(253),xn=e(163),kn=e(180),Ln=e(26),Sn=e(94),Un=e(59),Fn=e(57),En=e(209),Rn=e(402),Tn=e(231),Xn=e(76),An=e(36),Bn=e(544),zn=e(1531),$n=e(1538),On=e(951),Nn=e(55),Hn=d._1({encapsulation:2,styles:[],data:{animation:[{type:7,name:"coreSlideInOut",definitions:[{type:1,expr:"void => fromLeft",animation:[{type:6,styles:{transform:"translateX(0)",opacity:1},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"translateX(-100%)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(5%)",offset:.7},offset:null},{type:6,styles:{opacity:1,transform:"translateX(0)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"fromLeft => void",animation:[{type:6,styles:{transform:"translateX(-100%)",opacity:0},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:1,transform:"translateX(0)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(5%)",offset:.3},offset:null},{type:6,styles:{opacity:0,transform:"translateX(-100%)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"void => fromRight",animation:[{type:6,styles:{transform:"translateX(0)",opacity:1},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"translateX(100%)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(-5%)",offset:.7},offset:null},{type:6,styles:{opacity:1,transform:"translateX(0)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"fromRight => void",animation:[{type:6,styles:{transform:"translateX(-100%)",opacity:0},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:1,transform:"translateX(0)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(-5%)",offset:.3},offset:null},{type:6,styles:{opacity:0,transform:"translateX(100%)",offset:1},offset:null}]},timings:300}],options:null}],options:{}}]}}),jn=d.Z("page-addon-messages-discussion",w,function(n){return d._27(0,[(n()(),d._3(0,0,null,null,1,"page-addon-messages-discussion",[],null,null,null,c,Hn)),d._2(1,180224,null,0,w,[f.a,m.a,Nn.a,p.a,cn.a,_.a,y.a,h.a,b.a,v.a,M.a,J.a],null,null)],null,null)},{},{},[]),Jn=e(18),Kn=e(304),Vn=e(305),Yn=e(307),Wn=e(306),qn=e(390),Gn=e(528),Zn=e(224);e.d(l,"AddonMessagesDiscussionPageModuleNgFactory",function(){return Qn});var Qn=d._0(k,[],function(n){return d._11([d._12(512,d.j,d.W,[[8,[L.a,S.a,U.a,F.a,E.a,R.a,T.a,X.a,A.a,B.a,z.a,$.a,jn]],[3,d.j],d.v]),d._12(4608,q.m,q.l,[d.t,[2,q.v]]),d._12(4608,Jn.x,Jn.x,[]),d._12(4608,Jn.d,Jn.d,[]),d._12(4608,Kn.b,Kn.a,[]),d._12(4608,Vn.a,Vn.b,[]),d._12(4608,Yn.b,Yn.a,[]),d._12(4608,Wn.b,Wn.a,[]),d._12(4608,J.a,J.a,[qn.a,Kn.b,Vn.a,Yn.b,Wn.b,J.b,J.c]),d._12(512,q.b,q.b,[]),d._12(512,Jn.v,Jn.v,[]),d._12(512,Jn.i,Jn.i,[]),d._12(512,Jn.s,Jn.s,[]),d._12(512,Gn.a,Gn.a,[]),d._12(512,g.a,g.a,[]),d._12(512,D.a,D.a,[]),d._12(512,x.a,x.a,[]),d._12(512,P.a,P.a,[]),d._12(512,Gn.b,Gn.b,[]),d._12(512,k,k,[]),d._12(256,J.c,void 0,[]),d._12(256,J.b,void 0,[]),d._12(256,Zn.a,w,[])])})},1531:function(n,l,e){"use strict";function t(n){return s._27(2,[(n()(),s._3(0,0,null,null,1,"div",[["class","toolbar-background"]],null,null,null,null,null)),s._2(1,278528,null,0,a.i,[s.r,s.s,s.l,s.D],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),s._14(null,0),s._14(null,1),s._14(null,2),(n()(),s._3(5,0,null,null,2,"div",[["class","toolbar-content"]],null,null,null,null,null)),s._2(6,278528,null,0,a.i,[s.r,s.s,s.l,s.D],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),s._14(null,3)],function(n,l){var e=l.component;n(l,1,0,"toolbar-background","toolbar-background-"+e._mode);n(l,6,0,"toolbar-content","toolbar-content-"+e._mode)},null)}e.d(l,"a",function(){return o}),l.b=t;var s=e(1),a=e(9),o=(e(4),s._1({encapsulation:2,styles:[],data:{}}))},1538:function(n,l,e){"use strict";function t(n){return s._27(0,[(n()(),s._3(0,0,null,null,27,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(n,l,e){var t=!0,a=n.component;if("submit"===l){t=!1!==s._15(n,2).onSubmit(e)&&t}if("reset"===l){t=!1!==s._15(n,2).onReset()&&t}if("ngSubmit"===l){t=!1!==a.submitForm(e)&&t}return t},null,null)),s._2(1,16384,null,0,a.w,[],null,null),s._2(2,4210688,null,0,a.p,[[8,null],[8,null]],null,{ngSubmit:"ngSubmit"}),s._21(2048,null,a.b,null,[a.p]),s._2(4,16384,null,0,a.o,[a.b],null,null),(n()(),s._25(-1,null,["\n    "])),(n()(),s._3(6,0,null,null,7,"textarea",[["class","core-send-message-input"],["core-auto-rows",""],["name","message"],["rows","1"]],[[8,"placeholder",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"onResize"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],function(n,l,e){var t=!0,a=n.component;if("input"===l){t=!1!==s._15(n,7)._handleInput(e.target.value)&&t}if("blur"===l){t=!1!==s._15(n,7).onTouched()&&t}if("compositionstart"===l){t=!1!==s._15(n,7)._compositionStart()&&t}if("compositionend"===l){t=!1!==s._15(n,7)._compositionEnd(e.target.value)&&t}if("input"===l){t=!1!==s._15(n,13).onInput()&&t}if("change"===l){t=!1!==s._15(n,13).onChange()&&t}if("ngModelChange"===l){t=!1!==(a.message=e)&&t}if("onResize"===l){t=!1!==a.textareaResized()&&t}return t},null,null)),s._2(7,16384,null,0,a.c,[s.D,s.l,[2,a.a]],null,null),s._21(1024,null,a.l,function(n){return[n]},[a.c]),s._2(9,671744,null,0,a.q,[[2,a.b],[8,null],[8,null],[2,a.l]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),s._21(2048,null,a.m,null,[a.q]),s._2(11,16384,null,0,a.n,[a.m],null,null),s._2(12,81920,null,0,o.a,[s.l,i.a,u.a,[2,r.a]],{coreAutoFocus:[0,"coreAutoFocus"]},null),s._2(13,16384,null,0,c.a,[s.l],null,{onResize:"onResize"}),(n()(),s._25(-1,null,["\n    "])),(n()(),s._3(15,0,null,null,11,"ion-buttons",[["end",""]],null,null,null,null,null)),s._2(16,16384,null,1,d.a,[g.a,s.l,s.C,[2,f.a],[2,m.a]],null,null),s._23(603979776,1,{_buttons:1}),(n()(),s._25(-1,null,["\n        "])),(n()(),s._3(19,0,null,null,6,"button",[["clear","true"],["icon-only",""],["ion-button",""],["type","submit"]],[[8,"disabled",0],[1,"aria-label",0]],null,null,h.b,h.a)),s._2(20,1097728,[[1,4]],0,_.a,[[8,""],g.a,s.l,s.C],{clear:[0,"clear"]},null),s._18(131072,p.a,[y.a,s.g]),(n()(),s._25(-1,0,["\n            "])),(n()(),s._3(23,0,null,0,1,"ion-icon",[["color","dark"],["name","send"],["role","img"]],[[2,"hide",null]],null,null,null,null)),s._2(24,147456,null,0,v.a,[g.a,s.l,s.C],{color:[0,"color"],name:[1,"name"]},null),(n()(),s._25(-1,0,["\n        "])),(n()(),s._25(-1,null,["\n    "])),(n()(),s._25(-1,null,["\n"])),(n()(),s._25(-1,null,["\n"]))],function(n,l){var e=l.component;n(l,9,0,"message",e.message);n(l,12,0,e.showKeyboard);n(l,20,0,"true");n(l,24,0,"dark","send")},function(n,l){var e=l.component;n(l,0,0,s._15(l,4).ngClassUntouched,s._15(l,4).ngClassTouched,s._15(l,4).ngClassPristine,s._15(l,4).ngClassDirty,s._15(l,4).ngClassValid,s._15(l,4).ngClassInvalid,s._15(l,4).ngClassPending);n(l,6,0,e.placeholder,s._15(l,11).ngClassUntouched,s._15(l,11).ngClassTouched,s._15(l,11).ngClassPristine,s._15(l,11).ngClassDirty,s._15(l,11).ngClassValid,s._15(l,11).ngClassInvalid,s._15(l,11).ngClassPending);n(l,19,0,!e.message,s._26(l,19,1,s._15(l,21).transform("core.send")));n(l,23,0,s._15(l,24)._hidden)})}e.d(l,"a",function(){return b}),l.b=t;var s=e(1),a=e(18),o=e(312),i=e(7),u=e(5),r=e(21),c=e(967),d=e(392),g=e(4),f=e(223),m=e(179),h=e(44),_=e(39),p=e(29),y=e(17),v=e(38),b=(e(11),s._1({encapsulation:2,styles:[],data:{}}))}});