webpackJsonp([94],{1438:function(n,l,t){"use strict";function e(n){return o._27(0,[(n()(),o._3(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),o._2(1,16384,[[3,4]],0,Y.a,[V.a,o.l,o.C,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),o._25(2,null,["",""])),o._18(131072,q.a,[B.a,o.g])],function(n,l){n(l,1,0,"addon-data-groupslabel")},function(n,l){n(l,2,0,o._26(l,2,0,o._15(l,3).transform("core.groupsseparate")))})}function a(n){return o._27(0,[(n()(),o._3(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),o._2(1,16384,[[3,4]],0,Y.a,[V.a,o.l,o.C,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),o._25(2,null,["",""])),o._18(131072,q.a,[B.a,o.g])],function(n,l){n(l,1,0,"addon-data-groupslabel")},function(n,l){n(l,2,0,o._26(l,2,0,o._15(l,3).transform("core.groupsvisible")))})}function i(n){return o._27(0,[(n()(),o._3(0,0,null,null,2,"ion-option",[],null,null,null,null,null)),o._2(1,16384,[[6,4]],0,W.a,[o.l],{value:[0,"value"]},null),(n()(),o._25(2,null,["",""]))],function(n,l){n(l,1,0,l.context.$implicit.id)},function(n,l){n(l,2,0,l.context.$implicit.name)})}function r(n){return o._27(0,[(n()(),o._3(0,0,null,null,24,"ion-item",[["class","item item-block"],["text-wrap",""]],null,null,null,Z.b,Z.a)),o._2(1,1097728,null,3,z.a,[K.a,V.a,o.l,o.C,[2,Q.a]],null,null),o._23(603979776,3,{contentLabel:0}),o._23(603979776,4,{_buttons:1}),o._23(603979776,5,{_icons:1}),o._2(5,16384,null,0,X.a,[],null,null),(n()(),o._25(-1,2,["\n            "])),(n()(),o.Y(16777216,null,1,1,null,e)),o._2(8,16384,null,0,nn.k,[o.M,o.J],{ngIf:[0,"ngIf"]},null),(n()(),o._25(-1,2,["\n            "])),(n()(),o.Y(16777216,null,1,1,null,a)),o._2(11,16384,null,0,nn.k,[o.M,o.J],{ngIf:[0,"ngIf"]},null),(n()(),o._25(-1,2,["\n            "])),(n()(),o._3(13,0,null,3,10,"ion-select",[["aria-labelledby","addon-data-groupslabel"]],[[2,"select-disabled",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionChange"],[null,"click"],[null,"keyup.space"]],function(n,l,t){var e=!0,a=n.component;if("click"===l){e=!1!==o._15(n,14)._click(t)&&e}if("keyup.space"===l){e=!1!==o._15(n,14)._keyup()&&e}if("ngModelChange"===l){e=!1!==(a.selectedGroup=t)&&e}if("ionChange"===l){e=!1!==a.setGroup(a.selectedGroup)&&e}return e},ln.b,ln.a)),o._2(14,1228800,null,1,tn.a,[en.a,K.a,V.a,o.l,o.C,[2,z.a],an.a],null,{ionChange:"ionChange"}),o._23(603979776,6,{options:1}),o._21(1024,null,p.l,function(n){return[n]},[tn.a]),o._2(17,671744,null,0,p.q,[[8,null],[8,null],[8,null],[2,p.l]],{model:[0,"model"]},{update:"ngModelChange"}),o._21(2048,null,p.m,null,[p.q]),o._2(19,16384,null,0,p.n,[p.m],null,null),(n()(),o._25(-1,null,["\n                "])),(n()(),o.Y(16777216,null,null,1,null,i)),o._2(22,802816,null,0,nn.j,[o.M,o.J,o.r],{ngForOf:[0,"ngForOf"]},null),(n()(),o._25(-1,null,["\n            "])),(n()(),o._25(-1,2,["\n        "]))],function(n,l){var t=l.component;n(l,8,0,t.groupInfo.separateGroups);n(l,11,0,t.groupInfo.visibleGroups);n(l,17,0,t.selectedGroup);n(l,22,0,t.groupInfo.groups)},function(n,l){n(l,13,0,o._15(l,14)._disabled,o._15(l,19).ngClassUntouched,o._15(l,19).ngClassTouched,o._15(l,19).ngClassPristine,o._15(l,19).ngClassDirty,o._15(l,19).ngClassValid,o._15(l,19).ngClassInvalid,o._15(l,19).ngClassPending)})}function u(n){return o._27(0,[o._23(402653184,1,{content:0}),(n()(),o._3(1,0,null,null,24,"ion-header",[],null,null,null,null,null)),o._2(2,16384,null,0,rn.a,[V.a,o.l,o.C,[2,un.a]],null,null),(n()(),o._25(-1,null,["\n    "])),(n()(),o._3(4,0,null,null,20,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,on.b,on.a)),o._2(5,49152,null,0,dn.a,[en.a,[2,un.a],[2,sn.a],V.a,o.l,o.C],null,null),(n()(),o._25(-1,3,["\n        "])),(n()(),o._3(7,0,null,3,3,"ion-title",[],null,null,null,cn.b,cn.a)),o._2(8,49152,null,0,fn.a,[V.a,o.l,o.C,[2,_n.a],[2,dn.a]],null,null),(n()(),o._3(9,0,null,0,1,"core-format-text",[],null,null,null,null,null)),o._2(10,540672,null,0,hn.a,[o.l,y.a,m.a,pn.a,B.a,gn.a,g.a,mn.a,yn.a,vn.a,bn.a,In.a,[2,sn.a],[2,Cn.a]],{text:[0,"text"]},null),(n()(),o._25(-1,3,["\n        "])),(n()(),o._3(12,0,null,2,11,"ion-buttons",[["end",""]],null,null,null,null,null)),o._2(13,16384,null,1,En.a,[V.a,o.l,o.C,[2,_n.a],[2,dn.a]],null,null),o._23(603979776,2,{_buttons:1}),(n()(),o._25(-1,null,["\n            "])),(n()(),o._3(16,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,l,t){var e=!0;if("click"===l){e=!1!==n.component.save()&&e}return e},Pn.b,Pn.a)),o._2(17,1097728,[[2,4]],0,Dn.a,[[8,""],V.a,o.l,o.C],null,null),o._18(131072,q.a,[B.a,o.g]),(n()(),o._25(-1,0,["\n                "])),(n()(),o._3(20,0,null,0,1,"ion-icon",[["name","send"],["role","img"]],[[2,"hide",null]],null,null,null,null)),o._2(21,147456,null,0,Fn.a,[V.a,o.l,o.C],{name:[0,"name"]},null),(n()(),o._25(-1,0,["\n            "])),(n()(),o._25(-1,null,["\n        "])),(n()(),o._25(-1,3,["\n    "])),(n()(),o._25(-1,null,["\n"])),(n()(),o._25(-1,null,["\n"])),(n()(),o._3(27,0,null,null,23,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Tn.b,Tn.a)),o._2(28,4374528,[[1,4]],0,Cn.a,[V.a,gn.a,An.a,o.l,o.C,en.a,xn.a,o.x,[2,un.a],[2,sn.a]],null,null),(n()(),o._25(-1,1,["\n    "])),(n()(),o._3(30,0,null,1,19,"core-loading",[],null,null,null,Gn.b,Gn.a)),o._2(31,638976,null,0,jn.a,[B.a,o.l],{hideUntil:[0,"hideUntil"]},null),(n()(),o._25(-1,0,["\n        "])),(n()(),o.Y(16777216,null,0,1,null,r)),o._2(34,16384,null,0,nn.k,[o.M,o.J],{ngIf:[0,"ngIf"]},null),(n()(),o._25(-1,0,["\n\n        "])),(n()(),o._3(36,0,null,0,12,"div",[],[[8,"className",0]],null,null,null,null)),(n()(),o._25(-1,null,["\n            "])),(n()(),o._25(-1,null,["\n\n            "])),(n()(),o._3(39,0,null,null,8,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(n,l,t){var e=!0,a=n.component;if("submit"===l){e=!1!==o._15(n,41).onSubmit(t)&&e}if("reset"===l){e=!1!==o._15(n,41).onReset()&&e}if("ngSubmit"===l){e=!1!==a.save()&&e}return e},null,null)),o._2(40,16384,null,0,p.w,[],null,null),o._2(41,540672,null,0,p.h,[[8,null],[8,null]],{form:[0,"form"]},{ngSubmit:"ngSubmit"}),o._21(2048,null,p.b,null,[p.h]),o._2(43,16384,null,0,p.o,[p.b],null,null),(n()(),o._25(-1,null,["\n                "])),(n()(),o._3(45,0,null,null,1,"core-compile-html",[],null,null,null,wn.b,wn.a)),o._2(46,966656,null,0,Mn.a,[kn.a,o.g,o.l,[2,sn.a],o.s,m.a],{text:[0,"text"],jsData:[1,"jsData"],extraImports:[2,"extraImports"]},null),(n()(),o._25(-1,null,["\n            "])),(n()(),o._25(-1,null,["\n        "])),(n()(),o._25(-1,0,["\n    "])),(n()(),o._25(-1,1,["\n"])),(n()(),o._25(-1,null,["\n"]))],function(n,l){var t=l.component;n(l,10,0,t.title);n(l,21,0,"send");n(l,31,0,t.loaded);n(l,34,0,t.groupInfo&&(t.groupInfo.separateGroups||t.groupInfo.visibleGroups));n(l,41,0,t.editForm);n(l,46,0,t.editFormRender,t.jsData,t.extraImports)},function(n,l){var t=l.component;n(l,4,0,o._15(l,5)._hidden,o._15(l,5)._sbPadding);n(l,16,0,o._26(l,16,0,o._15(l,18).transform("core.save")));n(l,20,0,o._15(l,21)._hidden);n(l,27,0,o._15(l,28).statusbarPadding,o._15(l,28)._hasRefresher);n(l,36,0,o._6(1,"addon-data-contents ",t.cssClass,""));n(l,39,0,o._15(l,43).ngClassUntouched,o._15(l,43).ngClassTouched,o._15(l,43).ngClassPristine,o._15(l,43).ngClassDirty,o._15(l,43).ngClassValid,o._15(l,43).ngClassInvalid,o._15(l,43).ngClassPending)})}Object.defineProperty(l,"__esModule",{value:!0});var o=t(1),d=(t(0),t(10),t(8)),s=t(31),c=t(33),f=t(396),_=t(395),h=t(393),p=t(18),g=t(5),m=t(7),y=t(2),v=t(63),b=t(22),I=t(75),C=t(15),E=t(87),P=t(230),D=t(187),F=t(96),T=function(){function n(n,l,t,e,a,i,r,u,o,d,s,c,f,_){this.utils=l,this.groupsProvider=t,this.domUtils=e,this.fieldsDelegate=a,this.courseProvider=i,this.dataProvider=r,this.dataOffline=u,this.dataHelper=o,this.navCtrl=s,this.translate=c,this.eventsProvider=f,this.fileUploaderProvider=_,this.offlineActions=[],this.fields={},this.fieldsArray=[],this.forceLeave=!1,this.title="",this.component=E.a.COMPONENT,this.loaded=!1,this.selectedGroup=0,this.cssClass="",this.cssTemplate="",this.editFormRender="",this.extraImports=[h.a],this.errors={},this.module=n.get("module")||{},this.entryId=n.get("entryId")||null,this.courseId=n.get("courseId"),this.selectedGroup=n.get("group")||0,this.siteId=d.getCurrentSiteId(),this.title=this.module.name,this.editForm=new p.g({})}return n.prototype.ionViewDidLoad=function(){this.fetchEntryData()},n.prototype.ionViewCanLeave=function(){var n=this;if(this.forceLeave)return!0;var l=this.editForm.value;return this.dataHelper.hasEditDataChanged(l,this.fieldsArray,this.data.id,this.entry.contents).then(function(l){return l?n.domUtils.showConfirm(n.translate.instant("core.confirmcanceledit")):Promise.resolve()}).then(function(){return n.dataHelper.getEditTmpFiles(l,n.fieldsArray,n.data.id,n.entry.contents).then(function(l){n.fileUploaderProvider.clearTmpFiles(l)})})},n.prototype.fetchEntryData=function(){var n=this;return this.dataProvider.getDatabase(this.courseId,this.module.id).then(function(l){return n.title=l.name||n.title,n.data=l,n.cssClass="addon-data-entries-"+l.id,n.dataProvider.getDatabaseAccessInformation(l.id)}).then(function(l){if(n.cssTemplate=n.dataHelper.prefixCSS(n.data.csstemplate,"."+n.cssClass),n.entryId)return n.groupsProvider.getActivityGroupInfo(n.data.coursemodule,l.canmanageentries).then(function(l){n.groupInfo=l,l&&l.groups&&l.groups.length>0&&(l.groups.some(function(l){return n.selectedGroup==l.id})||(n.selectedGroup=l.groups[0].id))})}).then(function(){return n.dataOffline.getEntryActions(n.data.id,n.entryId)}).then(function(l){return n.offlineActions=l,n.dataProvider.getFields(n.data.id)}).then(function(l){return n.fieldsArray=l,n.fields=n.utils.arrayToObject(l,"id"),n.dataHelper.getEntry(n.data,n.entryId,n.offlineActions)}).then(function(l){return l?(l=l.entry).contents=n.utils.arrayToObject(l.contents,"fieldid"):l={contents:{}},n.dataHelper.applyOfflineActions(l,n.offlineActions,n.fieldsArray)}).then(function(l){n.entry=l,n.editFormRender=n.displayEditFields()}).catch(function(l){n.domUtils.showErrorModalDefault(l,"core.course.errorgetmodule",!0)}).finally(function(){n.loaded=!0})},n.prototype.save=function(){var n=this,l=this.editForm.value;return this.dataHelper.hasEditDataChanged(l,this.fieldsArray,this.data.id,this.entry.contents).then(function(t){if(!t)return n.entryId?n.returnToEntryList():Promise.reject("addon.mod_data.emptyaddform");var e=n.domUtils.showModalLoading("core.sending",!0),a=n.entryId?n.entryId:-(new Date).getTime();return n.dataHelper.getEditDataFromForm(l,n.fieldsArray,n.data.id,a,n.entry.contents,n.offline).catch(function(t){return n.offline?Promise.reject(t):(n.offline=!0,n.dataHelper.getEditDataFromForm(l,n.fieldsArray,n.data.id,a,n.entry.contents,n.offline))}).then(function(l){return l.length>0&&(n.entryId?n.dataProvider.editEntry(n.data.id,n.entryId,n.courseId,l,n.fields,void 0,n.offline):n.dataProvider.addEntry(n.data.id,a,n.courseId,l,n.selectedGroup,n.fields,void 0,n.offline))}).then(function(l){if(!l)return Promise.reject("addon.mod_data.emptyaddform");if(n.entryId&&l.updated||!n.entryId&&l.newentryid){var t=[];return n.entryId=n.entryId||l.newentryid,t.push(n.dataProvider.invalidateEntryData(n.data.id,n.entryId,n.siteId)),t.push(n.dataProvider.invalidateEntriesData(n.data.id,n.siteId)),Promise.all(t).then(function(){n.eventsProvider.trigger(E.a.ENTRY_CHANGED,{dataId:n.data.id,entryId:n.entryId},n.siteId)}).finally(function(){return n.returnToEntryList()})}n.errors={},l.fieldnotifications.forEach(function(l){var t=n.fieldsArray.find(function(n){return n.name==l.fieldname});t&&(n.errors[t.id]=l.notification)}),n.jsData.errors=n.errors,setTimeout(function(){n.scrollToFirstError()})}).finally(function(){e.dismiss()})}).catch(function(l){return n.domUtils.showErrorModalDefault(l,"Cannot edit entry",!0),Promise.reject(null)})},n.prototype.setGroup=function(n){return this.selectedGroup=n,this.loaded=!1,this.fetchEntryData()},n.prototype.displayEditFields=function(){if(!this.data.addtemplate)return"";this.jsData={fields:this.fields,contents:this.entry.contents,form:this.editForm,data:this.data,errors:this.errors};var n,l=this.data.addtemplate;return this.fieldsArray.forEach(function(t){n=(n="[["+t.name+"]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),l=l.replace(n,'<addon-mod-data-field-plugin mode="edit" [field]="fields['+t.id+']"                [value]="contents['+t.id+']" [form]="form" [database]="data" [error]="errors['+t.id+']">                </addon-mod-data-field-plugin>'),n=(n="[["+t.name+"#id]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),l=l.replace(n,"field_"+t.id)}),l},n.prototype.returnToEntryList=function(){var n=this;return this.dataHelper.getEditTmpFiles(this.editForm.value,this.fieldsArray,this.data.id,this.entry.contents).then(function(l){n.fileUploaderProvider.clearTmpFiles(l)}).finally(function(){n.forceLeave=!0,n.navCtrl.pop()})},n.prototype.scrollToFirstError=function(){this.domUtils.scrollToElementBySelector(this.content,".addon-data-error")||this.content.scrollToTop()},n}(),A=function(){return function(){}}(),x=t(925),G=t(926),j=t(927),w=t(928),M=t(929),k=t(930),U=t(931),H=t(932),L=t(933),O=t(936),S=t(937),R=t(938),N=t(939),$=t(532),J=t(950),Y=t(62),V=t(4),q=t(29),B=t(17),W=t(102),Z=t(34),z=t(20),K=t(19),Q=t(30),X=t(32),nn=t(9),ln=t(120),tn=t(103),en=t(28),an=t(49),rn=t(391),un=t(35),on=t(934),dn=t(179),sn=t(21),cn=t(935),fn=t(308),_n=t(223),hn=t(41),pn=t(11),gn=t(14),mn=t(24),yn=t(3),vn=t(16),bn=t(13),In=t(23),Cn=t(25),En=t(392),Pn=t(44),Dn=t(39),Fn=t(38),Tn=t(180),An=t(26),xn=t(94),Gn=t(59),jn=t(57),wn=t(188),Mn=t(156),kn=t(126),Un=t(55),Hn=o._1({encapsulation:0,styles:["{{ cssTemplate }}"],data:{}}),Ln=o.Z("page-addon-mod-data-edit",T,function(n){return o._27(0,[(n()(),o._3(0,0,null,null,1,"page-addon-mod-data-edit",[],null,null,null,u,Hn)),o._2(1,49152,null,0,T,[Un.a,g.a,v.a,m.a,F.a,C.a,E.a,D.a,P.a,y.a,sn.a,B.a,b.a,I.a],null,null)],null,null)},{},{},[]),On=t(304),Sn=t(305),Rn=t(307),Nn=t(306),$n=t(390),Jn=t(528),Yn=t(119),Vn=t(73),qn=t(224);t.d(l,"AddonModDataEditPageModuleNgFactory",function(){return Bn});var Bn=o._0(A,[],function(n){return o._11([o._12(512,o.j,o.W,[[8,[x.a,G.a,j.a,w.a,M.a,k.a,U.a,H.a,L.a,O.a,S.a,R.a,N.a,$.a,J.a,Ln]],[3,o.j],o.v]),o._12(4608,nn.m,nn.l,[o.t,[2,nn.v]]),o._12(4608,p.x,p.x,[]),o._12(4608,p.d,p.d,[]),o._12(4608,On.b,On.a,[]),o._12(4608,Sn.a,Sn.b,[]),o._12(4608,Rn.b,Rn.a,[]),o._12(4608,Nn.b,Nn.a,[]),o._12(4608,B.a,B.a,[$n.a,On.b,Sn.a,Rn.b,Nn.b,B.b,B.c]),o._12(512,s.a,s.a,[]),o._12(512,nn.b,nn.b,[]),o._12(512,p.v,p.v,[]),o._12(512,p.i,p.i,[]),o._12(512,p.s,p.s,[]),o._12(512,Jn.a,Jn.a,[]),o._12(512,d.a,d.a,[]),o._12(512,Yn.a,Yn.a,[]),o._12(512,c.a,c.a,[]),o._12(512,Vn.a,Vn.a,[]),o._12(512,_.a,_.a,[]),o._12(512,f.a,f.a,[]),o._12(512,h.a,h.a,[]),o._12(512,Jn.b,Jn.b,[]),o._12(512,A,A,[]),o._12(256,B.c,void 0,[]),o._12(256,B.b,void 0,[]),o._12(256,qn.a,T,[])])})}});