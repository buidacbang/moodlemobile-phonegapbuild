webpackJsonp([107],{1415:function(n,l,e){"use strict";function t(n){return c._27(0,[(n()(),c._3(0,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.openCourseFilter(e)&&t}return t},H.b,H.a)),c._2(1,1097728,[[3,4]],0,J.a,[[8,""],U.a,c.l,c.C],null,null),c._18(131072,j.a,[V.a,c.g]),(n()(),c._25(-1,0,["\n                "])),(n()(),c._3(4,0,null,0,1,"ion-icon",[["name","funnel"],["role","img"]],[[2,"hide",null]],null,null,null,null)),c._2(5,147456,null,0,W.a,[U.a,c.l,c.C],{name:[0,"name"]},null),(n()(),c._25(-1,0,["\n            "]))],function(n,l){n(l,5,0,"funnel")},function(n,l){n(l,0,0,c._26(l,0,0,c._15(l,2).transform("core.courses.filter")));n(l,4,0,c._15(l,5)._hidden)})}function i(n){return c._27(0,[(n()(),c._3(0,0,null,null,3,"core-empty-box",[["icon","calendar"]],null,null,null,z.b,z.a)),c._2(1,49152,null,0,G.a,[],{message:[0,"message"],icon:[1,"icon"]},null),c._18(131072,j.a,[V.a,c.g]),(n()(),c._25(-1,0,["\n            "]))],function(n,l){n(l,1,0,c._26(l,1,0,c._15(l,2).transform("addon.calendar.noevents")),"calendar")},null)}function a(n){return c._27(0,[(n()(),c._3(0,0,null,null,0,"img",[["class","core-module-icon"],["item-start",""]],[[8,"src",4]],null,null,null,null))],null,function(n,l){n(l,0,0,c._6(1,"",l.parent.context.$implicit.moduleIcon,""))})}function u(n){return c._27(0,[(n()(),c._3(0,0,null,null,1,"ion-icon",[["item-start",""],["role","img"]],[[2,"hide",null]],null,null,null,null)),c._2(1,147456,[[6,4]],0,W.a,[U.a,c.l,c.C],{name:[0,"name"]},null)],function(n,l){n(l,1,0,c._6(1,"",l.parent.context.$implicit.icon,""))},function(n,l){n(l,0,0,c._15(l,1)._hidden)})}function o(n){return c._27(0,[(n()(),c._3(0,0,null,null,20,"a",[["class","item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.gotoEvent(n.context.$implicit.id)&&t}return t},Z.b,Z.a)),c._2(1,1097728,null,3,q.a,[B.a,U.a,c.l,c.C,[2,K.a]],null,null),c._23(335544320,4,{contentLabel:0}),c._23(603979776,5,{_buttons:1}),c._23(603979776,6,{_icons:1}),c._2(5,16384,null,0,Q.a,[],null,null),(n()(),c._25(-1,2,["\n                    "])),(n()(),c.Y(16777216,null,0,1,null,a)),c._2(8,16384,null,0,X.k,[c.M,c.J],{ngIf:[0,"ngIf"]},null),(n()(),c._25(-1,2,["\n                    "])),(n()(),c.Y(16777216,null,0,1,null,u)),c._2(11,16384,null,0,X.k,[c.M,c.J],{ngIf:[0,"ngIf"]},null),(n()(),c._25(-1,2,["\n                    "])),(n()(),c._3(13,0,null,2,2,"h2",[],null,null,null,null,null)),(n()(),c._3(14,0,null,null,1,"core-format-text",[],null,null,null,null,null)),c._2(15,540672,null,0,nn.a,[c.l,y.a,m.a,ln.a,V.a,en.a,b.a,tn.a,an.a,un.a,x.a,on.a,[2,rn.a],[2,sn.a]],{text:[0,"text"]},null),(n()(),c._25(-1,2,["\n                    "])),(n()(),c._3(17,0,null,2,2,"p",[],null,null,null,null,null)),(n()(),c._25(18,null,["",""])),c._20(19,1),(n()(),c._25(-1,2,["\n                "]))],function(n,l){n(l,8,0,l.context.$implicit.moduleIcon);n(l,11,0,!l.context.$implicit.moduleIcon);n(l,15,0,l.context.$implicit.name)},function(n,l){n(l,0,0,l.context.$implicit.name,l.context.$implicit.id==l.component.eventId);n(l,18,0,c._26(l,18,0,n(l,19,0,c._15(l.parent.parent,0),l.context.$implicit.timestart)))})}function r(n){return c._27(0,[(n()(),c._3(0,0,null,null,5,"ion-list",[["no-margin",""]],null,null,null,null,null)),c._2(1,16384,null,0,cn.a,[U.a,c.l,c.C,en.a,dn.l,_n.a],null,null),(n()(),c._25(-1,null,["\n                "])),(n()(),c.Y(16777216,null,null,1,null,o)),c._2(4,802816,null,0,X.j,[c.M,c.J,c.r],{ngForOf:[0,"ngForOf"]},null),(n()(),c._25(-1,null,["\n            "]))],function(n,l){n(l,4,0,l.component.filteredEvents)},null)}function s(n){return c._27(0,[c._18(0,fn.a,[an.a]),c._23(402653184,1,{content:0}),c._23(402653184,2,{splitviewCtrl:0}),(n()(),c._3(3,0,null,null,27,"ion-header",[],null,null,null,null,null)),c._2(4,16384,null,0,hn.a,[U.a,c.l,c.C,[2,vn.a]],null,null),(n()(),c._25(-1,null,["\n    "])),(n()(),c._3(6,0,null,null,23,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,gn.b,gn.a)),c._2(7,49152,null,0,pn.a,[mn.a,[2,vn.a],[2,rn.a],U.a,c.l,c.C],null,null),(n()(),c._25(-1,3,["\n        "])),(n()(),c._3(9,0,null,3,3,"ion-title",[],null,null,null,bn.b,bn.a)),c._2(10,49152,null,0,yn.a,[U.a,c.l,c.C,[2,Cn.a],[2,pn.a]],null,null),(n()(),c._25(11,0,["",""])),c._18(131072,j.a,[V.a,c.g]),(n()(),c._25(-1,3,["\n        "])),(n()(),c._3(14,0,null,2,14,"ion-buttons",[["end",""]],null,null,null,null,null)),c._2(15,16384,null,1,En.a,[U.a,c.l,c.C,[2,Cn.a],[2,pn.a]],null,null),c._23(603979776,3,{_buttons:1}),(n()(),c._25(-1,null,["\n            "])),(n()(),c.Y(16777216,null,null,1,null,t)),c._2(19,16384,null,0,X.k,[c.M,c.J],{ngIf:[0,"ngIf"]},null),(n()(),c._25(-1,null,["\n            "])),(n()(),c._3(21,0,null,null,6,"core-context-menu",[],null,null,null,In.b,In.a)),c._2(22,245760,null,0,xn.a,[V.a,Ln.a,c.l,m.a,[2,Dn.a]],null,null),(n()(),c._25(-1,0,["\n                "])),(n()(),c._3(24,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,l,e){var t=!0;if("action"===l){t=!1!==n.component.openSettings()&&t}return t},Tn.b,Tn.a)),c._2(25,770048,null,0,Mn.a,[xn.a],{content:[0,"content"],iconAction:[1,"iconAction"],priority:[2,"priority"],hidden:[3,"hidden"]},{action:"action"}),c._18(131072,j.a,[V.a,c.g]),(n()(),c._25(-1,0,["\n            "])),(n()(),c._25(-1,null,["\n        "])),(n()(),c._25(-1,3,["\n    "])),(n()(),c._25(-1,null,["\n"])),(n()(),c._25(-1,null,["\n"])),(n()(),c._3(32,0,null,null,31,"core-split-view",[],null,null,null,Pn.b,Pn.a)),c._2(33,114688,[[2,4]],0,L.a,[[2,rn.a],c.l],null,null),(n()(),c._25(-1,0,["\n    "])),(n()(),c._3(35,0,null,0,27,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,An.b,An.a)),c._2(36,4374528,[[1,4]],0,sn.a,[U.a,en.a,_n.a,c.l,c.C,mn.a,kn.a,c.x,[2,vn.a],[2,rn.a]],null,null),(n()(),c._25(-1,1,["\n        "])),(n()(),c._3(38,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(n,l,e){var t=!0;if("ionRefresh"===l){t=!1!==n.component.refreshEvents(e)&&t}return t},null,null)),c._2(39,212992,null,0,Rn.a,[en.a,sn.a,c.x,dn.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(n()(),c._25(-1,null,["\n            "])),(n()(),c._3(41,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,Fn.b,Fn.a)),c._2(42,114688,null,0,wn.a,[Rn.a,U.a],{pullingText:[0,"pullingText"]},null),c._18(131072,j.a,[V.a,c.g]),(n()(),c._25(-1,null,["\n        "])),(n()(),c._25(-1,1,["\n        "])),(n()(),c._3(46,0,null,1,15,"core-loading",[],null,null,null,$n.b,$n.a)),c._2(47,638976,null,0,Nn.a,[V.a,c.l],{hideUntil:[0,"hideUntil"]},null),(n()(),c._25(-1,0,["\n            "])),(n()(),c.Y(16777216,null,0,1,null,i)),c._2(50,16384,null,0,X.k,[c.M,c.J],{ngIf:[0,"ngIf"]},null),(n()(),c._25(-1,0,["\n\n            "])),(n()(),c.Y(16777216,null,0,1,null,r)),c._2(53,16384,null,0,X.k,[c.M,c.J],{ngIf:[0,"ngIf"]},null),(n()(),c._25(-1,0,["\n\n            "])),(n()(),c._3(55,0,null,0,5,"ion-infinite-scroll",[],null,[[null,"ionInfinite"]],function(n,l,e){var t=!0;if("ionInfinite"===l){t=!1!==e.waitFor(n.component.fetchEvents())&&t}return t},null,null)),c._2(56,1196032,null,0,On.a,[sn.a,c.x,c.l,_n.a],{enabled:[0,"enabled"]},{ionInfinite:"ionInfinite"}),(n()(),c._25(-1,null,["\n               "])),(n()(),c._3(58,0,null,null,1,"ion-infinite-scroll-content",[],[[1,"state",0]],null,null,Sn.b,Sn.a)),c._2(59,114688,null,0,Yn.a,[On.a,U.a],null,null),(n()(),c._25(-1,null,["\n            "])),(n()(),c._25(-1,0,["\n        "])),(n()(),c._25(-1,1,["\n    "])),(n()(),c._25(-1,0,["\n"]))],function(n,l){var e=l.component;n(l,19,0,e.courses&&e.courses.length),n(l,22,0);n(l,25,0,c._26(l,25,0,c._15(l,26).transform("core.settings.settings")),"cog",600,!e.notificationsEnabled),n(l,33,0);n(l,39,0,e.eventsLoaded);n(l,42,0,c._6(1,"",c._26(l,42,0,c._15(l,43).transform("core.pulltorefresh")),""));n(l,47,0,e.eventsLoaded);n(l,50,0,!e.filteredEvents||!e.filteredEvents.length);n(l,53,0,e.filteredEvents&&e.filteredEvents.length);n(l,56,0,e.canLoadMore),n(l,59,0)},function(n,l){n(l,6,0,c._15(l,7)._hidden,c._15(l,7)._sbPadding);n(l,11,0,c._26(l,11,0,c._15(l,12).transform("addon.calendar.calendarevents")));n(l,35,0,c._15(l,36).statusbarPadding,c._15(l,36)._hasRefresher);n(l,38,0,"inactive"!==c._15(l,39).state,c._15(l,39)._top);n(l,41,0,c._15(l,42).r.state);n(l,58,0,c._15(l,59).inf.state)})}Object.defineProperty(l,"__esModule",{value:!0});var c=e(1),d=(e(0),e(10),e(8)),_=e(33),f=e(31),h=e(119),v=e(399),g=e(537),p=e(74),m=e(7),b=e(5),y=e(2),C=e(115),E=e(568),I=e(22),x=e(13),L=e(129),D=function(){function n(n,l,e,t,i,a,u,o,r,s,c,d,_){var f=this;this.translate=n,this.calendarProvider=l,this.domUtils=t,this.coursesProvider=i,this.utils=a,this.calendarHelper=u,this.popoverCtrl=s,this.navCtrl=d,this.daysLoaded=0,this.emptyEventsTimes=0,this.categoriesRetrieved=!1,this.getCategories=!1,this.allCourses={id:-1,fullname:this.translate.instant("core.fulllistofcourses"),category:-1},this.categories={},this.eventsLoaded=!1,this.events=[],this.notificationsEnabled=!1,this.filteredEvents=[],this.canLoadMore=!1,this.filter={course:this.allCourses},this.siteHomeId=o.getCurrentSite().getSiteHomeId(),this.notificationsEnabled=r.isAvailable(),this.notificationsEnabled&&(this.obsDefaultTimeChange=c.on(v.a.DEFAULT_NOTIFICATION_TIME_CHANGED,function(){l.scheduleEventsNotifications(f.events)},o.getCurrentSiteId())),this.eventId=e.get("eventid")||!1}return n.prototype.ionViewDidLoad=function(){var n=this;this.eventId&&this.gotoEvent(this.eventId),this.fetchData().then(function(){!n.eventId&&n.splitviewCtrl.isOn()&&n.events.length>0&&n.gotoEvent(n.events[0].id)}).finally(function(){n.eventsLoaded=!0})},n.prototype.fetchData=function(n){var l=this;return void 0===n&&(n=!1),this.daysLoaded=0,this.emptyEventsTimes=0,this.coursesProvider.getUserCourses(!1).then(function(e){return e.unshift(l.allCourses),l.courses=e,l.fetchEvents(n)})},n.prototype.fetchEvents=function(n){var l=this;return void 0===n&&(n=!1),this.calendarProvider.getEventsList(this.daysLoaded,v.a.DAYS_INTERVAL).then(function(e){if(l.daysLoaded+=v.a.DAYS_INTERVAL,0===e.length){if(l.emptyEventsTimes++,!(l.emptyEventsTimes>5))return l.fetchEvents();l.canLoadMore=!1,n&&(l.events=[],l.filteredEvents=[])}else e.sort(function(n,l){return n.timestart-l.timestart}),e.forEach(l.calendarHelper.formatEventData.bind(l.calendarHelper)),l.getCategories=l.shouldLoadCategories(e),l.events=n?e:l.utils.mergeArraysWithoutDuplicates(l.events,e,"id"),l.filteredEvents=l.getFilteredEvents(),l.canLoadMore=!0,l.calendarProvider.scheduleEventsNotifications(l.events);l.content.resize()}).catch(function(n){l.domUtils.showErrorModalDefault(n,"addon.calendar.errorloadevents",!0),l.canLoadMore=!1}).then(function(){if(l.getCategories)return l.getCategories=!1,l.loadCategories()})},n.prototype.getFilteredEvents=function(){return-1==this.filter.course.id?this.events:this.events.filter(this.shouldDisplayEvent.bind(this))},n.prototype.shouldDisplayEvent=function(n){if("user"==n.eventtype||"site"==n.eventtype)return!0;if("category"==n.eventtype){if(!n.categoryid||!Object.keys(this.categories).length)return!0;if(n.categoryid==this.filter.course.category)return!0;for(var l=this.categories[this.filter.course.category];l&&l.parent;){if(n.categoryid==l.parent)return!0;l=this.categories[l.parent]}return!1}return n.courseid===this.siteHomeId||n.courseid==this.filter.course.id},n.prototype.shouldLoadCategories=function(n){if(this.categoriesRetrieved||this.getCategories)return this.getCategories;return n.some(function(n){return"undefined"!=n.categoryid&&n.categoryid>0})||this.getCategories},n.prototype.loadCategories=function(){var n=this;return this.coursesProvider.getCategories(0,!0).then(function(l){n.categoriesRetrieved=!0,n.categories={},l.forEach(function(l){n.categories[l.id]=l})}).catch(function(){})},n.prototype.refreshEvents=function(n){var l=this,e=[];e.push(this.calendarProvider.invalidateEventsList(this.courses)),this.categoriesRetrieved&&(e.push(this.coursesProvider.invalidateCategories(0,!0)),this.categoriesRetrieved=!1),Promise.all(e).finally(function(){l.fetchData(!0).finally(function(){n.complete()})})},n.prototype.openCourseFilter=function(n){var l=this,e=this.popoverCtrl.create(E.a,{courses:this.courses,courseId:this.filter.course.id});e.onDidDismiss(function(n){n&&(l.filter.course=n,l.content.scrollToTop(),l.filteredEvents=l.getFilteredEvents())}),e.present({ev:n})},n.prototype.openSettings=function(){this.navCtrl.push("AddonCalendarSettingsPage")},n.prototype.gotoEvent=function(n){this.eventId=n,this.splitviewCtrl.push("AddonCalendarEventPage",{id:n})},n.prototype.ngOnDestroy=function(){this.obsDefaultTimeChange&&this.obsDefaultTimeChange.off()},n}(),T=function(){return function(){}}(),M=e(925),P=e(926),A=e(927),k=e(928),R=e(929),F=e(930),w=e(931),$=e(932),N=e(933),O=e(936),S=e(937),Y=e(938),H=e(44),J=e(39),U=e(4),j=e(29),V=e(17),W=e(38),z=e(149),G=e(130),Z=e(34),q=e(20),B=e(19),K=e(30),Q=e(32),X=e(9),nn=e(41),ln=e(11),en=e(14),tn=e(24),an=e(3),un=e(16),on=e(23),rn=e(21),sn=e(25),cn=e(76),dn=e(36),_n=e(26),fn=e(946),hn=e(391),vn=e(35),gn=e(934),pn=e(179),mn=e(28),bn=e(935),yn=e(308),Cn=e(223),En=e(392),In=e(79),xn=e(69),Ln=e(67),Dn=e(68),Tn=e(80),Mn=e(71),Pn=e(394),An=e(180),kn=e(94),Rn=e(140),Fn=e(200),wn=e(147),$n=e(59),Nn=e(57),On=e(209),Sn=e(402),Yn=e(231),Hn=e(55),Jn=c._1({encapsulation:2,styles:[],data:{}}),Un=c.Z("page-addon-calendar-list",D,function(n){return c._27(0,[(n()(),c._3(0,0,null,null,1,"page-addon-calendar-list",[],null,null,null,s,Jn)),c._2(1,180224,null,0,D,[V.a,v.a,Hn.a,m.a,p.a,b.a,g.a,y.a,C.a,Ln.a,I.a,rn.a,x.a],null,null)],null,null)},{},{},[]),jn=e(18),Vn=e(304),Wn=e(305),zn=e(307),Gn=e(306),Zn=e(390),qn=e(528),Bn=e(224);e.d(l,"AddonCalendarListPageModuleNgFactory",function(){return Kn});var Kn=c._0(T,[],function(n){return c._11([c._12(512,c.j,c.W,[[8,[M.a,P.a,A.a,k.a,R.a,F.a,w.a,$.a,N.a,O.a,S.a,Y.a,Un]],[3,c.j],c.v]),c._12(4608,X.m,X.l,[c.t,[2,X.v]]),c._12(4608,jn.x,jn.x,[]),c._12(4608,jn.d,jn.d,[]),c._12(4608,Vn.b,Vn.a,[]),c._12(4608,Wn.a,Wn.b,[]),c._12(4608,zn.b,zn.a,[]),c._12(4608,Gn.b,Gn.a,[]),c._12(4608,V.a,V.a,[Zn.a,Vn.b,Wn.a,zn.b,Gn.b,V.b,V.c]),c._12(512,X.b,X.b,[]),c._12(512,jn.v,jn.v,[]),c._12(512,jn.i,jn.i,[]),c._12(512,jn.s,jn.s,[]),c._12(512,qn.a,qn.a,[]),c._12(512,d.a,d.a,[]),c._12(512,f.a,f.a,[]),c._12(512,h.a,h.a,[]),c._12(512,_.a,_.a,[]),c._12(512,qn.b,qn.b,[]),c._12(512,T,T,[]),c._12(256,V.c,void 0,[]),c._12(256,V.b,void 0,[]),c._12(256,Bn.a,D,[])])})}});